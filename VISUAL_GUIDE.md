# Visual Guide: PM2.5 Sensor Integration

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          AIR QUALITY MONITOR SYSTEM                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   BME680     â”‚  â”‚ PM2.5 Sensor â”‚  â”‚  H2S Sensor  â”‚  â”‚ Odor Sensor  â”‚   â”‚
â”‚  â”‚ (Temp, Hum) â”‚  â”‚ (PM1/2.5/10) â”‚  â”‚ (ADC Pin 34) â”‚  â”‚ (ADC Pin 35) â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                 â”‚                 â”‚                 â”‚             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                           â”‚                                                  â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚                    â”‚  I2C Bus      â”‚                                        â”‚
â”‚                    â”‚ (SDA=21, SCL=22)
â”‚                    â”‚  & ADC        â”‚                                        â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚                           â”‚                                                  â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                    â”‚   ESP32 Microcontroller â”‚                              â”‚
â”‚                    â”‚                          â”‚                              â”‚
â”‚                    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                              â”‚
â”‚                    â”‚ â”‚  BSEC Library    â”‚   â”‚                              â”‚
â”‚                    â”‚ â”‚  (IAQ Calc)      â”‚   â”‚                              â”‚
â”‚                    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                              â”‚
â”‚                    â”‚                          â”‚                              â”‚
â”‚                    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                              â”‚
â”‚                    â”‚ â”‚ AQI Calculator   â”‚â—„â”€â”€â”¤â—„â”€ PM2.5 Data                â”‚
â”‚                    â”‚ â”‚ (EPA Standard)   â”‚   â”‚                              â”‚
â”‚                    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                              â”‚
â”‚                    â”‚                          â”‚                              â”‚
â”‚                    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                              â”‚
â”‚                    â”‚ â”‚   JSON Output    â”‚   â”‚                              â”‚
â”‚                    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                              â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                               â”‚                                              â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚        â”‚                      â”‚                      â”‚                      â”‚
â”‚        â–¼                      â–¼                      â–¼                      â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚    â”‚ Serial â”‚            â”‚ HTTP   â”‚           â”‚  WebSocket
â”‚    â”‚Output  â”‚            â”‚ API    â”‚           â”‚           â”‚                 â”‚
â”‚    â”‚115200  â”‚            â”‚ Port   â”‚           â”‚ Port 81  â”‚                 â”‚
â”‚    â”‚        â”‚            â”‚8888    â”‚           â”‚          â”‚                 â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚        â”‚                      â”‚                      â”‚                      â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                               â”‚                                              â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚                        â”‚  Web Browser    â”‚                                  â”‚
â”‚                        â”‚  (localhost)    â”‚                                  â”‚
â”‚                        â”‚                  â”‚                                  â”‚
â”‚                        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                                 â”‚
â”‚                        â”‚ â”‚ Intake Tab   â”‚ â”‚                                 â”‚
â”‚                        â”‚ â”‚ â”œâ”€ IAQ        â”‚ â”‚                                 â”‚
â”‚                        â”‚ â”‚ â”œâ”€ PM1.0      â”‚ â”‚                                 â”‚
â”‚                        â”‚ â”‚ â”œâ”€ PM2.5      â”‚ â”‚                                 â”‚
â”‚                        â”‚ â”‚ â”œâ”€ PM10       â”‚ â”‚                                 â”‚
â”‚                        â”‚ â”‚ â”œâ”€ AQI Score  â”‚ â”‚                                 â”‚
â”‚                        â”‚ â”‚ â””â”€ AQI Level  â”‚ â”‚                                 â”‚
â”‚                        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                 â”‚
â”‚                        â”‚                  â”‚                                  â”‚
â”‚                        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                                 â”‚
â”‚                        â”‚ â”‚ Exhaust Tab  â”‚ â”‚                                 â”‚
â”‚                        â”‚ â”‚ â”œâ”€ IAQ        â”‚ â”‚                                 â”‚
â”‚                        â”‚ â”‚ â”œâ”€ PM1.0      â”‚ â”‚                                 â”‚
â”‚                        â”‚ â”‚ â”œâ”€ PM2.5      â”‚ â”‚                                 â”‚
â”‚                        â”‚ â”‚ â”œâ”€ PM10       â”‚ â”‚                                 â”‚
â”‚                        â”‚ â”‚ â”œâ”€ AQI Score  â”‚ â”‚                                 â”‚
â”‚                        â”‚ â”‚ â””â”€ AQI Level  â”‚ â”‚                                 â”‚
â”‚                        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                 â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow

```
PM Sensor Reading (Every 3 seconds)
â”‚
â”œâ”€> Register 0x03: PM1.0 (2 bytes)
â”œâ”€> Register 0x04: PM2.5 (2 bytes)
â””â”€> Register 0x05: PM10 (2 bytes)
    â”‚
    â–¼
DFRobot_AirQualitySensor Driver
    â”‚
    â”œâ”€> i2c_read_bytes()
    â”‚   â”œâ”€ Create I2C command
    â”‚   â”œâ”€ Send register address
    â”‚   â”œâ”€ Read 2 bytes
    â”‚   â”œâ”€ Combine bytes: (byte0 << 8) | byte1
    â”‚   â””â”€ Return value in Âµg/mÂ³
    â”‚
    â–¼
Global Variables Updated
    â”œâ”€ pm1_0 (uint16_t)
    â”œâ”€ pm2_5 (uint16_t)
    â””â”€ pm10 (uint16_t)
    â”‚
    â–¼
calculate_aqi() Function
    â”‚
    â”œâ”€ Input: pm2_5 concentration
    â”œâ”€ Check 6 EPA breakpoints
    â”œâ”€ Interpolate between breakpoints
    â”œâ”€ Output: aqi (float), aqi_level (string)
    â”‚
    â”œâ”€ Breakpoints Used:
    â”‚  â”œâ”€ 0-12: Good
    â”‚  â”œâ”€ 12-35.4: Moderate
    â”‚  â”œâ”€ 35.4-55.4: Unhealthy for Sensitive
    â”‚  â”œâ”€ 55.4-150.4: Unhealthy
    â”‚  â”œâ”€ 150.4-250.4: Very Unhealthy
    â”‚  â””â”€ 250.4+: Hazardous
    â”‚
    â–¼
JSON Output (to Serial & HTTP)
{
  "temperature": 24.5,
  "humidity": 45.0,
  "pressure": 1013.25,
  "iaq": 50.0,
  "h2s": 100,
  "odor": 200,
  "pm1_0": 10,      â—„â”€ NEW
  "pm2_5": 25,      â—„â”€ NEW
  "pm10": 40,       â—„â”€ NEW
  "aqi": 60.5,      â—„â”€ NEW
  "aqi_level": "Moderate"  â—„â”€ NEW
}
    â”‚
    â–¼
Web UI Fetch
    â”‚
    â”œâ”€> GET /api/sensors
    â”œâ”€> Parse JSON
    â”œâ”€ intakeData updated with real values
    â”œâ”€ exhaustData = intakeData * 0.3 (30% of intake)
    â””â”€> calculateAQI(exhaustData)
    â”‚
    â–¼
Update Display
    â”œâ”€> updateIntakeSensors()
    â”‚   â”œâ”€ Set PM1.0 text content
    â”‚   â”œâ”€ Set PM2.5 text content
    â”‚   â”œâ”€ Set PM10 text content
    â”‚   â”œâ”€ Set AQI Score text content
    â”‚   â”œâ”€ Set AQI Level text content
    â”‚   â””â”€ Apply color class based on level
    â”‚
    â””â”€> updateExhaustSensors()
        â”œâ”€ Set PM1.0 text content
        â”œâ”€ Set PM2.5 text content
        â”œâ”€ Set PM10 text content
        â”œâ”€ Set AQI Score text content
        â”œâ”€ Set AQI Level text content
        â””â”€ Apply color class based on level
    â”‚
    â–¼
Display on Screen
    â”œâ”€ PM Values shown in Âµg/mÂ³
    â”œâ”€ AQI Score shown as number
    â”œâ”€ AQI Level shown with color:
    â”‚  â”œâ”€ Green (Good)
    â”‚  â”œâ”€ Yellow (Moderate)
    â”‚  â”œâ”€ Orange (Unhealthy for Sensitive)
    â”‚  â”œâ”€ Red (Unhealthy)
    â”‚  â”œâ”€ Purple (Very Unhealthy)
    â”‚  â””â”€ Dark Red (Hazardous)
    â”‚
    â””â”€> Update every 3 seconds
```

## I2C Register Layout

```
PM Sensor (Address 0x19)
â”œâ”€ Register 0x00: Firmware Version (1 byte)
â”‚  â””â”€ Contains version number
â”‚
â”œâ”€ Register 0x01-0x02: Reserved
â”‚
â”œâ”€ Register 0x03-0x04: PM1.0 Atmospheric (2 bytes, Big-Endian)
â”‚  â”œâ”€ [0x03] = Upper byte (MSB)
â”‚  â”œâ”€ [0x04] = Lower byte (LSB)
â”‚  â”œâ”€ Value = ([0x03] << 8) | [0x04]
â”‚  â””â”€ Unit: Âµg/mÂ³
â”‚
â”œâ”€ Register 0x04-0x05: PM2.5 Atmospheric (2 bytes, Big-Endian)
â”‚  â”œâ”€ [0x04] = Upper byte (MSB)
â”‚  â”œâ”€ [0x05] = Lower byte (LSB)
â”‚  â”œâ”€ Value = ([0x04] << 8) | [0x05]
â”‚  â””â”€ Unit: Âµg/mÂ³
â”‚
â””â”€ Register 0x05-0x06: PM10 Atmospheric (2 bytes, Big-Endian)
   â”œâ”€ [0x05] = Upper byte (MSB)
   â”œâ”€ [0x06] = Lower byte (LSB)
   â”œâ”€ Value = ([0x05] << 8) | [0x06]
   â””â”€ Unit: Âµg/mÂ³
```

## AQI Color Scheme

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                     AQI LEVEL COLOR GUIDE                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  Level             â•‘  Color          â•‘  PM2.5     â•‘  AQI Range     â•‘
â•‘                    â•‘  & Hex Code     â•‘  Âµg/mÂ³     â•‘                â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Good               â•‘ ðŸŸ¢ Green        â•‘ 0-12       â•‘ 0-50           â•‘
â•‘                    â•‘ #4CAF50         â•‘            â•‘                â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Moderate           â•‘ ðŸŸ¡ Yellow       â•‘ 12-35.4    â•‘ 51-100         â•‘
â•‘                    â•‘ #FFC107         â•‘            â•‘                â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Unhealthy for      â•‘ ðŸŸ  Orange       â•‘ 35.5-55.4  â•‘ 101-150        â•‘
â•‘ Sensitive Groups   â•‘ #FF9800         â•‘            â•‘                â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Unhealthy          â•‘ ðŸ”´ Red          â•‘ 55.5-150.4 â•‘ 151-200        â•‘
â•‘                    â•‘ #F44336         â•‘            â•‘                â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Very Unhealthy     â•‘ ðŸŸ£ Purple       â•‘ 150.5-250.4â•‘ 201-300        â•‘
â•‘                    â•‘ #9C27B0         â•‘            â•‘                â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Hazardous          â•‘ ðŸ”´ Dark Red     â•‘ 250.5+     â•‘ 301+           â•‘
â•‘                    â•‘ #5D1A1A         â•‘            â•‘                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## User Interface Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Air Purifier Monitor                          â”‚
â”‚                    Real-time Air Quality Analysis                   â”‚
â”‚                                          [Connected] [âš™ï¸ IP Config] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [Intake Air] [Exhaust Air]                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Overall Air Quality                                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           [IAQ Score]  [Status]   â”‚  â”‚
â”‚  â”‚  â”‚  [Gauge Image] 50%   â”‚                                    â”‚  â”‚
â”‚  â”‚  â”‚  ~~~~~~~~~~~~~~~~~~~~â”‚                                    â”‚  â”‚
â”‚  â”‚  â”‚  [Green] [Yellow][Red]â”‚                                   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Particulate Matter (PM)                                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚  â”‚
â”‚  â”‚  â”‚  PM1.0       â”‚  PM2.5       â”‚  PM10        â”‚              â”‚  â”‚
â”‚  â”‚  â”‚  10 Âµg/mÂ³    â”‚  25 Âµg/mÂ³    â”‚  40 Âµg/mÂ³    â”‚              â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Air Quality Index (AQI)                                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚  â”‚
â”‚  â”‚  â”‚  AQI Score           â”‚  AQI Level           â”‚             â”‚  â”‚
â”‚  â”‚  â”‚  60.5                â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ Moderate â”‚            â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Environmental Conditions                                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚  â”‚
â”‚  â”‚  â”‚ Temperature  â”‚  Humidity    â”‚  Pressure    â”‚              â”‚  â”‚
â”‚  â”‚  â”‚ 24.5Â°C       â”‚  45%         â”‚  1013.25 hPa â”‚              â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚  [Additional sections... H2S, Odor, eCO2, Gas Resistance, etc.]   â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Integration Files Structure

```
/home/arjunc/aer.pm2.5/bme680_test/
â”œâ”€â”€ main/
â”‚   â”œâ”€â”€ bme680_test.c                    (MODIFIED - Added PM reading)
â”‚   â”œâ”€â”€ CMakeLists.txt                   (MODIFIED - Added driver to build)
â”‚   â”œâ”€â”€ DFRobot_AirQualitySensor.h        (NEW - PM sensor header)
â”‚   â”œâ”€â”€ DFRobot_AirQualitySensor.c        (NEW - PM sensor driver)
â”‚   â”œâ”€â”€ bme68x.c
â”‚   â”œâ”€â”€ bme68x.h
â”‚   â””â”€â”€ bme68x_defs.h
â”‚
â”œâ”€â”€ web-ui/
â”‚   â”œâ”€â”€ index.html                       (MODIFIED - Added PM/AQI sections)
â”‚   â”œâ”€â”€ app.js                           (MODIFIED - Added PM/AQI logic)
â”‚   â”œâ”€â”€ styles.css                       (MODIFIED - Added AQI colors)
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ bme680/
â”‚   â””â”€â”€ bsec/
â”‚
â”œâ”€â”€ build/                               (Build output)
â”‚
â”œâ”€â”€ PM_SENSOR_INTEGRATION.md             (NEW - Full documentation)
â”œâ”€â”€ INTEGRATION_SUMMARY.md               (NEW - Quick reference)
â”œâ”€â”€ CODE_EXAMPLES.md                     (NEW - Code examples)
â”œâ”€â”€ IMPLEMENTATION_CHECKLIST.md          (NEW - Task checklist)
â”‚
â”œâ”€â”€ CMakeLists.txt
â”œâ”€â”€ README_FIRST.txt
â”œâ”€â”€ SETUP.txt
â””â”€â”€ ... other project files ...
```

## Testing Workflow

```
                    Start
                      â”‚
                      â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Build Project       â”‚
            â”‚ idf.py build        â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                   Success?
                    â•±    â•²
                  Yes    No â†’ Debug errors
                   â”‚          â”‚
                   â”‚          â””â”€ Fix and rebuild
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Flash to ESP32      â”‚
        â”‚ idf.py flash        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Monitor Serial      â”‚
        â”‚ idf.py monitor      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        Check JSON output for:
        â”œâ”€ pm1_0 value
        â”œâ”€ pm2_5 value
        â”œâ”€ pm10 value
        â”œâ”€ aqi value
        â””â”€ aqi_level string
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Open Web UI         â”‚
        â”‚ localhost:80        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        Verify on Intake Tab:
        â”œâ”€ PM1.0 displays
        â”œâ”€ PM2.5 displays
        â”œâ”€ PM10 displays
        â”œâ”€ AQI Score shows
        â””â”€ AQI Level shows with color
                   â”‚
                   â–¼
        Verify on Exhaust Tab:
        â”œâ”€ PM values ~30% of intake
        â”œâ”€ AQI recalculated
        â””â”€ Color scheme works
                   â”‚
                   â–¼
                Success! âœ…
```

## Summary

This comprehensive PM2.5 sensor integration adds:
- **Hardware**: I2C-based PM sensor (DFRobot model)
- **Firmware**: PM reading + EPA standard AQI calculation
- **UI**: Real-time PM and AQI display with color coding
- **Features**: Automatic AQI level assignment (6 categories)
- **Support**: Both simulated and real hardware modes

The implementation follows best practices for embedded systems:
- Graceful degradation
- Minimal memory overhead
- Synchronous with existing sensor updates
- Comprehensive error handling
- Well-documented code
